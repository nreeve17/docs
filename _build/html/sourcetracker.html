<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Biota’s SourceTracker2 API &#8212; Biota 1.0 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Biota Metadata API" href="validate.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Biota</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="database.html">biota.database</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot.html">biota.plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">biota.util</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="validate.html">Biota Metadata API</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Biota’s SourceTracker2 API</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Biota’s SourceTracker2 API</a><ul>
<li><a class="reference internal" href="#module-sourcetracker.gibbs">gibbs</a><ul>
<li><a class="reference internal" href="#notes">Notes</a></li>
<li><a class="reference internal" href="#warnings">Warnings</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#returns">Returns</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="validate.html" title="Previous Chapter: Biota Metadata API"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Biota Metadata API</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/sourcetracker.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="biota-s-sourcetracker2-api">
<h1>Biota’s SourceTracker2 API<a class="headerlink" href="#biota-s-sourcetracker2-api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-sourcetracker.gibbs">
<span id="gibbs"></span><h2>gibbs<a class="headerlink" href="#module-sourcetracker.gibbs" title="Permalink to this headline">¶</a></h2>
<p>Gibb’s sampling API.</p>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<p>This function exists to allow API calls to source/sink prediction and
leave-one-out (LOO) source prediction.</p>
<p>Input validation is done on the sources and sinks (if not None). They must
be dataframes with integerial data (or castable to such). If both
sources and sinks are provided, their columns must agree exactly.</p>
<p>Input validation is done on the Gibb’s parameters, to make sure they are
numerically acceptable (all must be non-negative, some must be positive
integers - see below).</p>
</div>
<div class="section" id="warnings">
<h3>Warnings<a class="headerlink" href="#warnings" title="Permalink to this headline">¶</a></h3>
<p>This function does _not_ perform rarefaction, the user should perform
rarefaction prior to calling this function.</p>
<p>This function does not collapse sources or sinks, it expects each row of
the <cite>sources</cite> dataframe to represent a unique source, and each row of the
<cite>sinks</cite> dataframe to represent a unique sink.</p>
</div>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>sources <span class="classifier-delimiter">:</span> <span class="classifier">DataFrame</span></dt>
<dd>A dataframe containing source data (rows are sources, columns are
features). The index must be the names of the sources.</dd>
<dt>sinks <span class="classifier-delimiter">:</span> <span class="classifier">DataFrame or None</span></dt>
<dd>A dataframe containing sink data (rows are sinks, columns are
features). The index must be the names of the sinks. If <cite>None</cite>,
leave-one-out (LOO) prediction will be done.</dd>
<dt>alpha1 <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Prior counts of each feature in the training environments. Higher
values decrease the trust in the training environments, and make
the source environment distributions over taxa smoother. A value of
0.001 indicates reasonably high trust in all source environments, even
those with few training sequences. A more conservative value would be
0.01.</dd>
<dt>alpha2 <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Prior counts of each feature in the Unknown environment. Higher
values make the Unknown environment smoother and less prone to
overfitting given a training sample.</dd>
<dt>beta <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Number of prior counts of test sequences from each feature in each
environment.</dd>
<dt>restarts <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Number of independent Markov chains to grow. <cite>draws_per_restart</cite> *
<cite>restarts</cite> gives the number of samplings of the mixing proportions that
will be generated.</dd>
<dt>draws_per_restart <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Number of times to sample the state of the Markov chain for each
independent chain grown.</dd>
<dt>burnin <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Number of passes (withdarawal and reassignment of every sequence in the
sink) that will be made before a sample (draw) will be taken. Higher
values allow more convergence towards the true distribtion before draws
are taken.</dd>
<dt>delay <span class="classifier-delimiter">:</span> <span class="classifier">int &gt;= 1</span></dt>
<dd>Number passes between each sampling (draw) of the Markov chain. Once
the burnin passes have been made, a sample will be taken, and
additional samples will be drawn every <cite>delay</cite> number of passes. This
is also known as ‘thinning’. Thinning helps reduce the impact of
correlation between adjacent states of the Markov chain.</dd>
<dt>cluster <span class="classifier-delimiter">:</span> <span class="classifier">ipyparallel.client.client.Client or None</span></dt>
<dd>An ipyparallel Client object, e.g. a started cluster.</dd>
<dt>create_feature_tables <span class="classifier-delimiter">:</span> <span class="classifier">boolean</span></dt>
<dd>If <cite>True</cite> create a feature table for each sink. The feature table
records the average count of each feature from each source for this
sink. This option can consume large amounts of memory if there are many
source, sinks, and features. If <cite>False</cite>, feature tables are not
created.</dd>
</dl>
</div>
<div class="section" id="returns">
<h3>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>mpm <span class="classifier-delimiter">:</span> <span class="classifier">DataFrame</span></dt>
<dd>Mixing proportion means. A dataframe containing the mixing proportions
(rows are sinks, columns are sources).</dd>
<dt>mps <span class="classifier-delimiter">:</span> <span class="classifier">DataFrame</span></dt>
<dd>Mixing proportion standard deviations. A dataframe containing the
mixing proportions standard deviations (rows are sinks, columns are
sources).</dd>
<dt>fas <span class="classifier-delimiter">:</span> <span class="classifier">list</span></dt>
<dd>ith item is a pd.DataFrame of the average feature assignments from each
source for the ith sink (in the same order as rows of <cite>mpm</cite> and <cite>mps</cite>).</dd>
</dl>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p># An example of using the normal prediction.
&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; from ipyparallel import Client
&gt;&gt;&gt; import subprocess
&gt;&gt;&gt; import time
&gt;&gt;&gt; from sourcetracker import gibbs</p>
<p># Prepare some source data.
&gt;&gt;&gt; otus = np.array([‘o%s’ % i for i in range(50)])
&gt;&gt;&gt; source1 = np.random.randint(0, 1000, size=50)
&gt;&gt;&gt; source2 = np.random.randint(0, 1000, size=50)
&gt;&gt;&gt; source3 = np.random.randint(0, 1000, size=50)
&gt;&gt;&gt; source_df = pd.DataFrame([source1, source2, source3],</p>
<blockquote>
<div>index=[‘source1’, ‘source2’, ‘source3’],
columns=otus, dtype=np.int32)</div></blockquote>
<p># Prepare some sink data.
&gt;&gt;&gt; sink1 = np.ceil(.5*source1+.5*source2)
&gt;&gt;&gt; sink2 = np.ceil(.5*source2+.5*source3)
&gt;&gt;&gt; sink3 = np.ceil(.5*source1+.5*source3)
&gt;&gt;&gt; sink4 = source1
&gt;&gt;&gt; sink5 = source2
&gt;&gt;&gt; sink6 = np.random.randint(0, 1000, size=50)
&gt;&gt;&gt; sink_df = pd.DataFrame([sink1, sink2, sink3, sink4, sink5, sink6],</p>
<blockquote>
<div><dl class="docutils">
<dt>index=np.array([‘sink%s’ % i for i in</dt>
<dd>range(1,7)]),</dd>
</dl>
<p>columns=otus, dtype=np.int32)</p>
</div></blockquote>
<p># Set paramaters
&gt;&gt;&gt; alpha1 = .01
&gt;&gt;&gt; alpha2 = .001
&gt;&gt;&gt; beta = 10
&gt;&gt;&gt; restarts = 5
&gt;&gt;&gt; draws_per_restart = 1
&gt;&gt;&gt; burnin = 2
&gt;&gt;&gt; delay = 2</p>
<p># Call without a cluster
&gt;&gt;&gt; mpm, mps, fas = gibbs(source_df, sink_df, alpha1, alpha2, beta,</p>
<blockquote>
<div>restarts, draws_per_restart, burnin, delay,
cluster=None, create_feature_tables=True)</div></blockquote>
<p># Start a cluster and call the function
&gt;&gt;&gt; jobs = 4
&gt;&gt;&gt; subprocess.Popen(‘ipcluster start -n %s –quiet’ % jobs, shell=True)
&gt;&gt;&gt; time.sleep(25)
&gt;&gt;&gt; c = Client()
&gt;&gt;&gt; mpm, mps, fas = gibbs(source_df, sink_df, alpha1, alpha2, beta,</p>
<blockquote>
<div>restarts, draws_per_restart, burnin, delay,
cluster=c, create_feature_tables=True)</div></blockquote>
<p># LOO prediction.
&gt;&gt;&gt; mpm, mps, fas = gibbs(source_df, sinks=None, alpha1, alpha2, beta,</p>
<blockquote>
<div>restarts, draws_per_restart, burnin, delay,
cluster=c, create_feature_tables=True)</div></blockquote>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Nico Reeve.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>